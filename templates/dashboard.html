{% extends 'base.html' %}

{% block title %}–î–∞—à–±–æ—Ä–¥ - InstagramOSINT{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard">
    <div class="dashboard-header">
        <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ current_user.username }}! üëã</h1>
        {% if current_user.company_name %}
            <p class="company-name">{{ current_user.company_name }}</p>
        {% endif %}
    </div>
    
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">üë§</div>
            <div class="stat-content">
                <h3>{{ instagram_accounts_count }}</h3>
                <p>Instagram –∞–∫–∫–∞—É–Ω—Ç–æ–≤</p>
            </div>
            <a href="{{ url_for('manage_accounts') }}" class="stat-link">–£–ø—Ä–∞–≤–ª—è—Ç—å ‚Üí</a>
        </div>
        
        <div class="stat-card highlight">
            <div class="stat-icon">üë•</div>
            <div class="stat-content">
                <h3>{{ total_followers }}</h3>
                <p>–°–æ–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</p>
            </div>
            <a href="{{ url_for('followers_table') }}" class="stat-link">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å ‚Üí</a>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üìß</div>
            <div class="stat-content">
                <h3>{{ followers_with_email }}</h3>
                <p>–° email –∞–¥—Ä–µ—Å–∞–º–∏</p>
            </div>
            <a href="{{ url_for('followers_table') }}?has_email=on" class="stat-link">–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å ‚Üí</a>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üîç</div>
            <div class="stat-content">
                <h3>{{ parse_sessions_count }}</h3>
                <p>–°–µ—Å—Å–∏–π –ø–∞—Ä—Å–∏–Ω–≥–∞</p>
            </div>
            <a href="{{ url_for('statistics') }}" class="stat-link">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Üí</a>
        </div>
    </div>
    
    <div class="quick-actions">
        <h2>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
        <div class="actions-grid">
            <a href="{{ url_for('parse_competitors') }}" class="action-card">
                <span class="action-icon">üîç</span>
                <span class="action-text">–ù–∞—á–∞—Ç—å –ø–∞—Ä—Å–∏–Ω–≥</span>
            </a>
            <a href="{{ url_for('manage_accounts') }}" class="action-card">
                <span class="action-icon">‚ûï</span>
                <span class="action-text">–î–æ–±–∞–≤–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</span>
            </a>
            <a href="{{ url_for('export_csv') }}" class="action-card">
                <span class="action-icon">üì•</span>
                <span class="action-text">–≠–∫—Å–ø–æ—Ä—Ç CSV</span>
            </a>
            <a href="{{ url_for('publish_content') }}" class="action-card">
                <span class="action-icon">üì§</span>
                <span class="action-text">–ü—É–±–ª–∏–∫–∞—Ü–∏—è</span>
            </a>
        </div>
    </div>
    
    <div class="recent-sessions">
        <h2>–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞</h2>
        
        {% if recent_sessions %}
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–°–æ–±—Ä–∞–Ω–æ</th>
                            <th>–î–∞—Ç–∞</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for session in recent_sessions %}
                            <tr>
                                <td class="competitors-cell">
                                    {% for username in session.competitor_usernames[:3] %}
                                        <span class="competitor-tag">@{{ username }}</span>
                                    {% endfor %}
                                    {% if session.competitor_usernames|length > 3 %}
                                        <span class="more-tag">+{{ session.competitor_usernames|length - 3 }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="badge badge-{{ session.status }}">
                                        {% if session.status == 'completed' %}‚úì –ó–∞–≤–µ—Ä—à–µ–Ω–æ
                                        {% elif session.status == 'processing' %}‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞
                                        {% elif session.status == 'failed' %}‚úó –û—à–∏–±–∫–∞
                                        {% else %}‚è∏ –û–∂–∏–¥–∞–Ω–∏–µ{% endif %}
                                    </span>
                                </td>
                                <td><strong>{{ session.total_followers_collected }}</strong></td>
                                <td>{{ session.started_at.strftime('%d.%m.%Y %H:%M') }}</td>
                                <td>
                                    <a href="{{ url_for('followers_table', session_id=session.id) }}" class="btn btn-small">
                                        –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="empty-state">
                <p>–£ –≤–∞—Å –µ—â–µ –Ω–µ—Ç —Å–µ—Å—Å–∏–π –ø–∞—Ä—Å–∏–Ω–≥–∞.</p>
                <a href="{{ url_for('parse_competitors') }}" class="btn btn-primary">–ù–∞—á–∞—Ç—å –ø–∞—Ä—Å–∏–Ω–≥</a>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
