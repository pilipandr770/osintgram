{% extends 'base.html' %}

{% block title %}–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞{% endblock %}

{% block content %}
<div class="statistics-page">
    <div class="page-header">
        <h1>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞</h1>
        <p>–û–±–∑–æ—Ä –≤—Å–µ—Ö —Å–µ—Å—Å–∏–π –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</p>
    </div>
    
    <div class="stats-overview">
        <div class="stat-card">
            <div class="stat-icon">üë•</div>
            <div class="stat-content">
                <h3>{{ total_followers }}</h3>
                <p>–í—Å–µ–≥–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üìß</div>
            <div class="stat-content">
                <h3>{{ followers_with_email }}</h3>
                <p>–° email</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">‚úì</div>
            <div class="stat-content">
                <h3>{{ verified_followers }}</h3>
                <p>–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üíº</div>
            <div class="stat-content">
                <h3>{{ business_followers }}</h3>
                <p>–ë–∏–∑–Ω–µ—Å-–∞–∫–∫–∞—É–Ω—Ç–æ–≤</p>
            </div>
        </div>
    </div>
    
    <div class="two-columns">
        <div class="sessions-section">
            <div class="card">
                <h2>üîç –ò—Å—Ç–æ—Ä–∏—è —Å–µ—Å—Å–∏–π –ø–∞—Ä—Å–∏–Ω–≥–∞</h2>
                
                {% if sessions %}
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–°–æ–±—Ä–∞–Ω–æ</th>
                                    <th>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for session in sessions %}
                                    <tr>
                                        <td>{{ session.started_at.strftime('%d.%m.%Y %H:%M') }}</td>
                                        <td>
                                            {% for username in session.competitor_usernames %}
                                                <span class="competitor-tag">@{{ username }}</span>
                                            {% endfor %}
                                        </td>
                                        <td>
                                            <span class="badge badge-{{ session.status }}">
                                                {{ session.status }}
                                            </span>
                                        </td>
                                        <td><strong>{{ session.total_followers_collected }}</strong></td>
                                        <td>
                                            {% if session.duration_seconds %}
                                                {{ (session.duration_seconds // 60) }}–º {{ session.duration_seconds % 60 }}—Å
                                            {% else %}
                                                -
                                            {% endif %}
                                        </td>
                                        <td>
                                            <a href="{{ url_for('followers_table', session_id=session.id) }}" class="btn btn-small">
                                                –ü—Ä–æ—Å–º–æ—Ç—Ä
                                            </a>
                                        </td>
                                    </tr>
                                    
                                    {% if session.failed_accounts %}
                                        <tr class="error-row">
                                            <td colspan="6">
                                                <div class="error-details">
                                                    <strong>–û—à–∏–±–∫–∏:</strong>
                                                    {% for username, error in session.failed_accounts.items() %}
                                                        <span>@{{ username }}: {{ error }}</span>
                                                    {% endfor %}
                                                </div>
                                            </td>
                                        </tr>
                                    {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="empty-state">
                        <p>–ù–µ—Ç —Å–µ—Å—Å–∏–π –ø–∞—Ä—Å–∏–Ω–≥–∞</p>
                        <a href="{{ url_for('parse_competitors') }}" class="btn btn-primary">–ù–∞—á–∞—Ç—å –ø–∞—Ä—Å–∏–Ω–≥</a>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <div class="exports-section">
            <div class="card">
                <h2>üì• –ò—Å—Ç–æ—Ä–∏—è —ç–∫—Å–ø–æ—Ä—Ç–æ–≤</h2>
                
                {% if exports %}
                    <div class="exports-list">
                        {% for export in exports %}
                            <div class="export-item">
                                <div class="export-icon">
                                    {% if export.export_type == 'csv' %}üìÑ
                                    {% elif export.export_type == 'json' %}üìã
                                    {% else %}üì•{% endif %}
                                </div>
                                <div class="export-info">
                                    <span class="export-type">{{ export.export_type|upper }}</span>
                                    <span class="export-rows">{{ export.rows_exported }} –∑–∞–ø–∏—Å–µ–π</span>
                                    <span class="export-date">{{ export.exported_at.strftime('%d.%m.%Y %H:%M') }}</span>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <p>–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–æ–≤</p>
                    </div>
                {% endif %}
            </div>
            
            <div class="card">
                <h3>–ë—ã—Å—Ç—Ä—ã–π —ç–∫—Å–ø–æ—Ä—Ç</h3>
                <div class="export-actions">
                    <a href="{{ url_for('export_csv') }}" class="btn btn-success btn-block">
                        üì• Meta Ads CSV
                    </a>
                    <a href="{{ url_for('export_full_csv') }}" class="btn btn-secondary btn-block">
                        üì• –ü–æ–ª–Ω—ã–π CSV
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
