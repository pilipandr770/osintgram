{% extends "base.html" %}

{% block title %}üì® –†–æ–∑—Å–∏–ª–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å{% endblock %}

{% block content %}
<div class="container">
    <h1>üì® –†–æ–∑—Å–∏–ª–∫–∞ –≤ Direct</h1>
    
    <!-- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ -->
    <div class="alert alert-warning" style="background: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
        <h3>‚ö†Ô∏è –í–∞–∂–ª–∏–≤–æ! –õ—ñ–º—ñ—Ç–∏ Instagram:</h3>
        <ul>
            <li><strong>–ù–æ–≤—ñ –∞–∫–∞—É–Ω—Ç–∏:</strong> 10-20 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –Ω–∞ –¥–µ–Ω—å</li>
            <li><strong>–°—Ç–∞—Ä—ñ –∞–∫–∞—É–Ω—Ç–∏ (6+ –º—ñ—Å—è—Ü—ñ–≤):</strong> 50-80 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –Ω–∞ –¥–µ–Ω—å</li>
            <li><strong>–ó–∞—Ç—Ä–∏–º–∫–∞ –º—ñ–∂ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏:</strong> –º—ñ–Ω—ñ–º—É–º 30-60 —Å–µ–∫—É–Ω–¥</li>
            <li><strong>–†–∏–∑–∏–∫–∏:</strong> —Ç–∏–º—á–∞—Å–æ–≤–∏–π –±–∞–Ω, –æ–±–º–µ–∂–µ–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ–π, –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –∞–∫–∞—É–Ω—Ç–∞</li>
        </ul>
        <p>üí° –†–µ–∫–æ–º–µ–Ω–¥—É—î–º–æ: –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, –Ω–µ –±—ñ–ª—å—à–µ 20 –Ω–∞ –¥–µ–Ω—å, –ø—Ä–∏—Ä–æ–¥–Ω—ñ –∑–∞—Ç—Ä–∏–º–∫–∏.</p>
    </div>
    
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats-grid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px;">
        <div class="stat-card" style="background: #e8f5e9; padding: 20px; border-radius: 8px; text-align: center;">
            <div style="font-size: 2em; font-weight: bold; color: #2e7d32;">{{ total_followers }}</div>
            <div>–í—Å—å–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤</div>
        </div>
        <div class="stat-card" style="background: #e3f2fd; padding: 20px; border-radius: 8px; text-align: center;">
            <div style="font-size: 2em; font-weight: bold; color: #1565c0;">{{ target_audience }}</div>
            <div>–¶—ñ–ª—å–æ–≤–∞ –∞—É–¥–∏—Ç–æ—Ä—ñ—è</div>
        </div>
        <div class="stat-card" style="background: #fff3e0; padding: 20px; border-radius: 8px; text-align: center;">
            <div style="font-size: 2em; font-weight: bold; color: #ef6c00;">{{ messages_sent_today }}</div>
            <div>–í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ —Å—å–æ–≥–æ–¥–Ω—ñ</div>
        </div>
        <div class="stat-card" style="background: #fce4ec; padding: 20px; border-radius: 8px; text-align: center;">
            <div style="font-size: 2em; font-weight: bold; color: #c2185b;">{{ daily_limit - messages_sent_today }}</div>
            <div>–ó–∞–ª–∏—à–∏–ª–æ—Å—å —Å—å–æ–≥–æ–¥–Ω—ñ</div>
        </div>
    </div>
    
    <!-- –§–æ—Ä–º–∞ —Ä–æ–∑—Å–∏–ª–∫–∏ -->
    <div class="card" style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <h2>‚úçÔ∏è –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ä–æ–∑—Å–∏–ª–∫—É</h2>
        
        <form id="messagingForm" method="POST" action="{{ url_for('send_messages') }}">
            <!-- –í–∏–±—ñ—Ä –∞–∫–∞—É–Ω—Ç–∞ -->
            <div class="form-group" style="margin-bottom: 20px;">
                <label><strong>üì± –ê–∫–∞—É–Ω—Ç –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏:</strong></label>
                <select name="account_id" class="form-control" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ddd;" required>
                    <option value="">-- –û–±–µ—Ä—ñ—Ç—å –∞–∫–∞—É–Ω—Ç --</option>
                    {% for account in accounts %}
                    <option value="{{ account.id }}">@{{ account.username }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <!-- –í–∏–±—ñ—Ä –∞—É–¥–∏—Ç–æ—Ä—ñ—ó -->
            <div class="form-group" style="margin-bottom: 20px;">
                <label><strong>üë• –ö–æ–º—É –≤—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏:</strong></label>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <label style="display: flex; align-items: center; gap: 5px;">
                        <input type="radio" name="audience" value="target" checked> 
                        üéØ –¢—ñ–ª—å–∫–∏ —Ü—ñ–ª—å–æ–≤–∞ –∞—É–¥–∏—Ç–æ—Ä—ñ—è ({{ target_audience }})
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px;">
                        <input type="radio" name="audience" value="frankfurt"> 
                        üìç –†–µ–≥—ñ–æ–Ω –§—Ä–∞–Ω–∫—Ñ—É—Ä—Ç ({{ frankfurt_region }})
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px;">
                        <input type="radio" name="audience" value="all"> 
                        üìã –í—Å—ñ –∫–æ–Ω—Ç–∞–∫—Ç–∏ ({{ total_followers }})
                    </label>
                </div>
            </div>
            
            <!-- –õ–∏–º–∏—Ç -->
            <div class="form-group" style="margin-bottom: 20px;">
                <label><strong>üî¢ –ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å (–º–∞–∫—Å. {{ daily_limit - messages_sent_today }}):</strong></label>
                <input type="number" name="limit" class="form-control" 
                       style="width: 150px; padding: 10px; border-radius: 6px; border: 1px solid #ddd;"
                       min="1" max="{{ daily_limit - messages_sent_today }}" value="10" required>
            </div>
            
            <!-- –ó–∞—Ç—Ä–∏–º–∫–∞ -->
            <div class="form-group" style="margin-bottom: 20px;">
                <label><strong>‚è±Ô∏è –ó–∞—Ç—Ä–∏–º–∫–∞ –º—ñ–∂ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏ (—Å–µ–∫—É–Ω–¥):</strong></label>
                <input type="number" name="delay" class="form-control" 
                       style="width: 150px; padding: 10px; border-radius: 6px; border: 1px solid #ddd;"
                       min="30" max="300" value="45" required>
                <small style="color: #666;">–ú—ñ–Ω—ñ–º—É–º 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è –±–µ–∑–ø–µ–∫–∏</small>
            </div>
            
            <!-- –¢–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è -->
            <div class="form-group" style="margin-bottom: 20px;">
                <label><strong>üí¨ –¢–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:</strong></label>
                <textarea name="message" class="form-control" rows="5" 
                          style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ddd;"
                          placeholder="–í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è...

–ú–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑–º—ñ–Ω–Ω—ñ:
{name} - —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
{username} - @username" required></textarea>
                <small style="color: #666;">
                    –ü—Ä–∏–∫–ª–∞–¥: "–ü—Ä–∏–≤—ñ—Ç, {name}! –ú–∏ –∑–∞–π–º–∞—î–º–æ—Å—å —É–∫–ª–∞–¥–∞–Ω–Ω—è–º –ø–ª–∏—Ç–∫–∏ —É –§—Ä–∞–Ω–∫—Ñ—É—Ä—Ç—ñ. –¶—ñ–∫–∞–≤–∏—Ç—å –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è?"
                </small>
            </div>
            
            <!-- –®–∞–±–ª–æ–Ω—ã -->
            <div class="form-group" style="margin-bottom: 20px;">
                <label><strong>üìù –ì–æ—Ç–æ–≤—ñ —à–∞–±–ª–æ–Ω–∏:</strong></label>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button type="button" class="template-btn" onclick="useTemplate('intro')"
                            style="padding: 8px 15px; background: #e3f2fd; border: none; border-radius: 6px; cursor: pointer;">
                        üëã –ó–Ω–∞–π–æ–º—Å—Ç–≤–æ
                    </button>
                    <button type="button" class="template-btn" onclick="useTemplate('offer')"
                            style="padding: 8px 15px; background: #e8f5e9; border: none; border-radius: 6px; cursor: pointer;">
                        üíº –ü—Ä–æ–ø–æ–∑–∏—Ü—ñ—è
                    </button>
                    <button type="button" class="template-btn" onclick="useTemplate('discount')"
                            style="padding: 8px 15px; background: #fff3e0; border: none; border-radius: 6px; cursor: pointer;">
                        üéÅ –ó–Ω–∏–∂–∫–∞
                    </button>
                </div>
            </div>
            
            <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
            <div style="display: flex; gap: 15px; align-items: center;">
                <button type="submit" class="btn-primary" 
                        style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 30px; border: none; border-radius: 8px; font-size: 1.1em; cursor: pointer;">
                    üöÄ –ü–æ—á–∞—Ç–∏ —Ä–æ–∑—Å–∏–ª–∫—É
                </button>
                <label style="display: flex; align-items: center; gap: 5px;">
                    <input type="checkbox" name="confirm" required>
                    –Ø —Ä–æ–∑—É–º—ñ—é —Ä–∏–∑–∏–∫–∏ —Ç–∞ –ø–æ–≥–æ–¥–∂—É—é—Å—å
                </label>
            </div>
        </form>
    </div>
    
    <!-- –ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—Å—ã–ª–æ–∫ -->
    <div class="card" style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-top: 20px;">
        <h2>üìä –Ü—Å—Ç–æ—Ä—ñ—è —Ä–æ–∑—Å–∏–ª–æ–∫</h2>
        {% if message_logs %}
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #f5f5f5;">
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">–î–∞—Ç–∞</th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">–ê–∫–∞—É–Ω—Ç</th>
                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd;">–í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ</th>
                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd;">–£—Å–ø—ñ—à–Ω–æ</th>
                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd;">–ü–æ–º–∏–ª–∫–∏</th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">–°—Ç–∞—Ç—É—Å</th>
                </tr>
            </thead>
            <tbody>
                {% for log in message_logs %}
                <tr>
                    <td style="padding: 12px; border-bottom: 1px solid #eee;">{{ log.created_at.strftime('%d.%m.%Y %H:%M') }}</td>
                    <td style="padding: 12px; border-bottom: 1px solid #eee;">@{{ log.account_username }}</td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid #eee;">{{ log.total_sent }}</td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid #eee; color: green;">{{ log.successful }}</td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid #eee; color: red;">{{ log.failed }}</td>
                    <td style="padding: 12px; border-bottom: 1px solid #eee;">
                        {% if log.status == 'completed' %}
                        <span style="color: green;">‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ</span>
                        {% elif log.status == 'running' %}
                        <span style="color: orange;">üîÑ –í –ø—Ä–æ—Ü–µ—Å—ñ</span>
                        {% else %}
                        <span style="color: red;">‚ùå {{ log.status }}</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p style="color: #666; text-align: center; padding: 40px;">–ü–æ–∫–∏ –Ω–µ–º–∞—î —Ä–æ–∑—Å–∏–ª–æ–∫</p>
        {% endif %}
    </div>
</div>

<script>
const templates = {
    intro: `–ü—Ä–∏–≤—ñ—Ç, {name}! üëã

–ü–æ–±–∞—á–∏–≤ –≤–∞—à –ø—Ä–æ—Ñ—ñ–ª—å —ñ –≤–∏—Ä—ñ—à–∏–≤ –Ω–∞–ø–∏—Å–∞—Ç–∏. –ú–∏ –∑–∞–π–º–∞—î–º–æ—Å—å –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–º —É–∫–ª–∞–¥–∞–Ω–Ω—è–º –ø–ª–∏—Ç–∫–∏ —Ç–∞ —Ä–µ–º–æ–Ω—Ç–æ–º –≤–∞–Ω–Ω–∏—Ö –∫—ñ–º–Ω–∞—Ç —É —Ä–µ–≥—ñ–æ–Ω—ñ –§—Ä–∞–Ω–∫—Ñ—É—Ä—Ç.

–Ø–∫—â–æ –≤–∞—Å —Ü—ñ–∫–∞–≤–∏—Ç—å —è–∫—ñ—Å–Ω–∏–π —Ä–µ–º–æ–Ω—Ç - –±—É–¥—É —Ä–∞–¥–∏–π –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—è! üè†`,
    
    offer: `–í—ñ—Ç–∞—é, {name}! 

–ù–∞—à–∞ –∫–æ–º–ø–∞–Ω—ñ—è —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑—É—î—Ç—å—Å—è –Ω–∞:
üîπ –£–∫–ª–∞–¥–∞–Ω–Ω—è –ø–ª–∏—Ç–∫–∏
üîπ –†–µ–º–æ–Ω—Ç –≤–∞–Ω–Ω–∏—Ö –∫—ñ–º–Ω–∞—Ç
üîπ –°–∞–Ω—Ç–µ—Ö–Ω—ñ—á–Ω—ñ —Ä–æ–±–æ—Ç–∏

–ü—Ä–∞—Ü—é—î–º–æ –ø–æ –≤—Å—å–æ–º—É –§—Ä–∞–Ω–∫—Ñ—É—Ä—Ç—É —Ç–∞ –æ–∫–æ–ª–∏—Ü—è—Ö. –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π –≤–∏—ó–∑–¥ –Ω–∞ –∑–∞–º—ñ—Ä!

–ó–∞—Ü—ñ–∫–∞–≤–∏–ª–æ? –ù–∞–ø–∏—à—ñ—Ç—å - –æ–±–≥–æ–≤–æ—Ä–∏–º–æ –¥–µ—Ç–∞–ª—ñ üí¨`,
    
    discount: `–ü—Ä–∏–≤—ñ—Ç, {name}! üéÅ

–ú–∞—î–º–æ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—É –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—é –¥–ª—è –Ω–æ–≤–∏—Ö –∫–ª—ñ—î–Ω—Ç—ñ–≤:
‚≠ê -15% –Ω–∞ —É–∫–ª–∞–¥–∞–Ω–Ω—è –ø–ª–∏—Ç–∫–∏
‚≠ê –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è
‚≠ê –ì–∞—Ä–∞–Ω—Ç—ñ—è 2 —Ä–æ–∫–∏

–ê–∫—Ü—ñ—è –¥—ñ—î –¥–æ –∫—ñ–Ω—Ü—è –º—ñ—Å—è—Ü—è. –í—Å—Ç–∏–≥–Ω—ñ—Ç—å —Å–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏—Å—å! 

–ù–∞–ø–∏—à—ñ—Ç—å "–•–æ—á—É –∑–Ω–∏–∂–∫—É" –¥–ª—è –¥–µ—Ç–∞–ª–µ–π üëá`
};

function useTemplate(name) {
    document.querySelector('textarea[name="message"]').value = templates[name];
}
</script>

<style>
.template-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}
.btn-primary:hover {
    transform: scale(1.02);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
}
</style>
{% endblock %}
