{% extends "base.html" %}

{% block title %}ü§ñ AI –ê—Å–∏—Å—Ç–µ–Ω—Ç{% endblock %}

{% block content %}
<div class="container">
    <h1>ü§ñ AI –ê—Å–∏—Å—Ç–µ–Ω—Ç</h1>
    
    <!-- –°—Ç–∞—Ç—É—Å AI -->
    <div class="card" style="background: {% if ai_available %}#e8f5e9{% else %}#fff3e0{% endif %}; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
        {% if ai_available %}
        <p>‚úÖ <strong>OpenAI –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ!</strong> –í—Å—ñ AI —Ñ—É–Ω–∫—Ü—ñ—ó –¥–æ—Å—Ç—É–ø–Ω—ñ.</p>
        {% else %}
        <p>‚ö†Ô∏è <strong>OpenAI –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ.</strong> –î–æ–¥–∞–π—Ç–µ OPENAI_API_KEY –≤ .env —Ñ–∞–π–ª.</p>
        <code>OPENAI_API_KEY=sk-your-key-here</code>
        {% endif %}
    </div>
    
    <!-- Tabs -->
    <div class="tabs" style="display: flex; gap: 10px; margin-bottom: 20px;">
        <button class="tab-btn" data-tab="analyze" onclick="showTab('analyze', this)" style="padding: 10px 20px; border: none; background: #e0e0e0; border-radius: 6px; cursor: pointer;">
            üîç –ê–Ω–∞–ª—ñ–∑ –ø—Ä–æ—Ñ—ñ–ª—ñ–≤
        </button>
        <button class="tab-btn" data-tab="generate" onclick="showTab('generate', this)" style="padding: 10px 20px; border: none; background: #e0e0e0; border-radius: 6px; cursor: pointer;">
            ‚úçÔ∏è –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
        </button>
        <button class="tab-btn" data-tab="content" onclick="showTab('content', this)" style="padding: 10px 20px; border: none; background: #e0e0e0; border-radius: 6px; cursor: pointer;">
            üìù –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –ø–æ—Å—Ç—ñ–≤
        </button>
        <button class="tab-btn" data-tab="trends" onclick="showTab('trends', this)" style="padding: 10px 20px; border: none; background: #e0e0e0; border-radius: 6px; cursor: pointer;">
            üì∞ –¢—Ä–µ–Ω–¥–∏ (RSS)
        </button>
    </div>
    
    <!-- Tab: –ê–Ω–∞–ª—ñ–∑ –ø—Ä–æ—Ñ—ñ–ª—ñ–≤ -->
    <div id="tab-analyze" class="tab-content" style="{% if active_tab != 'analyze' %}display: none;{% endif %}">
        <div class="card" style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h2>üîç AI –ê–Ω–∞–ª—ñ–∑ –ø—Ä–æ—Ñ—ñ–ª—ñ–≤</h2>
            <p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –ø—Ä–æ—Ñ—ñ–ª—ñ–≤ –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ü—ñ–ª—å–æ–≤–æ—ó –∞—É–¥–∏—Ç–æ—Ä—ñ—ó.</p>
            
            <form method="POST" action="{{ url_for('ai_analyze_profiles') }}">
                <div class="form-group" style="margin-bottom: 15px;">
                    <label><strong>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–æ—Ñ—ñ–ª—ñ–≤ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É:</strong></label>
                    <input type="number" name="limit" value="20" min="1" max="100" 
                           style="padding: 10px; border: 1px solid #ddd; border-radius: 6px; width: 100px;">
                </div>
                
                <div class="form-group" style="margin-bottom: 15px;">
                    <label><strong>–§—ñ–ª—å—Ç—Ä:</strong></label>
                    <select name="filter" style="padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                        <option value="unanalyzed">–¢—ñ–ª—å–∫–∏ –Ω–µ–∞–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ</option>
                        <option value="all">–í—Å—ñ –ø—Ä–æ—Ñ—ñ–ª—ñ</option>
                        <option value="low_score">–ó –Ω–∏–∑—å–∫–∏–º —Ä–µ–π—Ç–∏–Ω–≥–æ–º</option>
                    </select>
                </div>
                
                <button type="submit" class="btn-primary" 
                        style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer;">
                    üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç–∏ AI –∞–Ω–∞–ª—ñ–∑
                </button>
            </form>
            
            {% if analysis_results %}
            <div style="margin-top: 20px;">
                <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∞–Ω–∞–ª—ñ–∑—É:</h3>
                <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                    <thead>
                        <tr style="background: #f5f5f5;">
                            <th style="padding: 10px; text-align: left;">Username</th>
                            <th style="padding: 10px; text-align: center;">–¢–∏–ø</th>
                            <th style="padding: 10px; text-align: center;">Score</th>
                            <th style="padding: 10px; text-align: left;">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for result in analysis_results %}
                        <tr>
                            <td style="padding: 10px;">@{{ result.username }}</td>
                            <td style="padding: 10px; text-align: center;">{{ result.ai_analysis.profile_type }}</td>
                            <td style="padding: 10px; text-align: center;">
                                <span style="background: {% if result.ai_analysis.quality_score >= 70 %}#4caf50{% elif result.ai_analysis.quality_score >= 40 %}#ff9800{% else %}#f44336{% endif %}; color: white; padding: 3px 8px; border-radius: 10px;">
                                    {{ result.ai_analysis.quality_score }}
                                </span>
                            </td>
                            <td style="padding: 10px;">{{ result.ai_analysis.contact_recommendation }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Tab: –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å -->
    <div id="tab-generate" class="tab-content" style="{% if active_tab != 'generate' %}display: none;{% endif %}">
        <div class="card" style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h2>‚úçÔ∏è –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å</h2>
            
            <form method="POST" action="{{ url_for('ai_generate_message') }}">
                <div class="form-group" style="margin-bottom: 15px;">
                    <label><strong>Username –æ—Ç—Ä–∏–º—É–≤–∞—á–∞:</strong></label>
                    <input type="text" name="username" placeholder="@username" 
                           style="padding: 10px; border: 1px solid #ddd; border-radius: 6px; width: 200px;">
                </div>
                
                <div class="form-group" style="margin-bottom: 15px;">
                    <label><strong>–ë—ñ–æ–≥—Ä–∞—Ñ—ñ—è (—è–∫—â–æ –≤—ñ–¥–æ–º–∞):</strong></label>
                    <textarea name="bio" rows="2" placeholder="–ë—ñ–æ–≥—Ä–∞—Ñ—ñ—è –ø—Ä–æ—Ñ—ñ–ª—é..."
                              style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;"></textarea>
                </div>
                
                <div class="form-group" style="margin-bottom: 15px;">
                    <label><strong>–ú–µ—Ç–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:</strong></label>
                    <select name="goal" style="padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                        <option value="–∑–Ω–∞–π–æ–º—Å—Ç–≤–æ">üëã –ü–µ—Ä—à–µ –∑–Ω–∞–π–æ–º—Å—Ç–≤–æ</option>
                        <option value="–ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—è">üíº –ü—Ä–æ–ø–æ–∑–∏—Ü—ñ—è –ø–æ—Å–ª—É–≥</option>
                        <option value="–∑–Ω–∏–∂–∫–∞">üéÅ –°–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—è</option>
                        <option value="follow_up">üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∏–π –∫–æ–Ω—Ç–∞–∫—Ç</option>
                    </select>
                </div>
                
                <button type="submit" class="btn-primary"
                        style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer;">
                    ‚ú® –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
                </button>
            </form>
            
            {% if generated_messages %}
            <div style="margin-top: 20px;">
                <h3>üí¨ –í–∞—Ä—ñ–∞–Ω—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å:</h3>
                {% for msg in generated_messages.messages %}
                <div style="background: #f5f5f5; padding: 15px; border-radius: 8px; margin-top: 10px;">
                    <p>{{ msg }}</p>
                    <button onclick="copyMessage(this)" style="margin-top: 10px; padding: 5px 15px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏
                    </button>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Tab: –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –ø–æ—Å—Ç—ñ–≤ -->
    <div id="tab-content" class="tab-content" style="{% if active_tab != 'content' %}display: none;{% endif %}">
        <div class="card" style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h2>üìù –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∫–æ–Ω—Ç–µ–Ω—Ç—É –¥–ª—è Instagram</h2>
            
            <form method="POST" action="{{ url_for('ai_generate_content') }}">
                <div class="form-group" style="margin-bottom: 15px;">
                    <label><strong>–¢–µ–º–∞ –ø–æ—Å—Ç–∞:</strong></label>
                    <input type="text" name="topic" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: —Ç—Ä–µ–Ω–¥–∏ –ø–ª–∏—Ç–∫–∏ 2025, –ø–æ—Ä–∞–¥–∏ —Ä–µ–º–æ–Ω—Ç—É –≤–∞–Ω–Ω–æ—ó..."
                           style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                </div>
                
                <div class="form-group" style="margin-bottom: 15px;">
                    <label><strong>–¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç—É:</strong></label>
                    <select name="post_type" style="padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                        <option value="informative">üìö –Ü–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–∏–π</option>
                        <option value="promotional">üì¢ –†–µ–∫–ª–∞–º–Ω–∏–π</option>
                        <option value="tips">üí° –ü–æ—Ä–∞–¥–∏</option>
                        <option value="behind_scenes">üé¨ –ó–∞ –ª–∞—à—Ç—É–Ω–∫–∞–º–∏</option>
                        <option value="before_after">üîÑ –î–æ/–ü—ñ—Å–ª—è</option>
                        <option value="trend">üî• –¢—Ä–µ–Ω–¥</option>
                    </select>
                </div>
                
                <button type="submit" class="btn-primary"
                        style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer;">
                    ‚ú® –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∫–æ–Ω—Ç–µ–Ω—Ç
                </button>
            </form>
            
            {% if generated_content %}
            <div style="margin-top: 20px;">
                <h3>üì± –ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç:</h3>
                
                <div style="background: #f5f5f5; padding: 20px; border-radius: 8px; margin-top: 10px;">
                    <h4>üéØ Hook (–ø–µ—Ä—à–∏–π —Ä—è–¥–æ–∫):</h4>
                    <p style="font-weight: bold; font-size: 1.1em;">{{ generated_content.hook }}</p>
                    
                    <h4 style="margin-top: 15px;">üìù –ü–æ–≤–Ω–∏–π —Ç–µ–∫—Å—Ç:</h4>
                    <p style="white-space: pre-line;">{{ generated_content.caption }}</p>
                    
                    <h4 style="margin-top: 15px;">üè∑Ô∏è –•–µ—à—Ç–µ–≥–∏:</h4>
                    <p style="color: #1976d2;">{{ generated_content.hashtags | join(' ') }}</p>
                    
                    {% if generated_content.content_ideas %}
                    <h4 style="margin-top: 15px;">üì∏ –Ü–¥–µ—ó –¥–ª—è —Ñ–æ—Ç–æ:</h4>
                    <ul>
                        {% for idea in generated_content.content_ideas %}
                        <li>{{ idea }}</li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                    
                    <button onclick="copyContent()" style="margin-top: 15px; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">
                        üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏ –≤—Å–µ
                    </button>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Tab: –¢—Ä–µ–Ω–¥–∏ -->
    <div id="tab-trends" class="tab-content" style="{% if active_tab != 'trends' %}display: none;{% endif %}">
        <div class="card" style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h2>üì∞ –¢—Ä–µ–Ω–¥–∏ –∑ RSS (–¥–∏–∑–∞–π–Ω, –ø–ª–∏—Ç–∫–∞, —Ä–µ–º–æ–Ω—Ç)</h2>

            <div style="background: #f7f7ff; padding: 15px; border-radius: 10px; margin: 15px 0 20px 0;">
                <h3 style="margin-top: 0;">‚öôÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è</h3>
                <form method="POST" action="{{ url_for('ai_update_automation_settings') }}" enctype="multipart/form-data" style="display: grid; gap: 10px;">
                    <label style="display:flex; gap:10px; align-items:center;">
                        <input type="checkbox" name="enabled" {% if automation_settings and automation_settings.enabled %}checked{% endif %}>
                        <span><strong>–£–≤—ñ–º–∫–Ω—É—Ç–∏</strong> —Ä–µ–≥—É–ª—è—Ä–Ω—É –ø–µ—Ä–µ–≤—ñ—Ä–∫—É RSS —Ç–∞ –ø—ñ–¥–≥–æ—Ç–æ–≤–∫—É —á–µ—Ä–Ω–µ—Ç–æ–∫</span>
                    </label>

                    <label style="display:flex; gap:10px; align-items:center;">
                        <input type="checkbox" name="auto_publish" {% if automation_settings and automation_settings.auto_publish %}checked{% endif %}>
                        <span><strong>–ê–≤—Ç–æ-–ø—É–±–ª—ñ–∫–∞—Ü—ñ—è</strong> –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (–ø–æ—Ç—Ä–µ–±—É—î –≤–∞–ª—ñ–¥–Ω–æ–≥–æ –≤—Ö–æ–¥—É –≤ Instagram)</span>
                    </label>

                    <label style="display:flex; gap:10px; align-items:center;">
                        <input type="checkbox" name="use_animation" {% if automation_settings and automation_settings.use_animation %}checked{% endif %}>
                        <span>–ê–Ω—ñ–º–∞—Ü—ñ—è —Ñ–æ—Ç–æ ‚Üí –≤—ñ–¥–µ–æ (Reel)</span>
                    </label>

                    <div style="display:flex; gap:12px; flex-wrap:wrap; align-items:flex-end;">
                        <div>
                            <label><strong>–î–æ–≤–∂–∏–Ω–∞ –∞–Ω—ñ–º–∞—Ü—ñ—ó (—Å–µ–∫):</strong></label><br>
                            <input type="number" name="animation_duration_seconds" min="3" max="60"
                                   value="{{ automation_settings.animation_duration_seconds if automation_settings and automation_settings.animation_duration_seconds else 8 }}"
                                   style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 120px;">
                        </div>

                        <div>
                            <label><strong>–ú—É–∑–∏–∫–∞ (—Ñ–∞–π–ª):</strong></label><br>
                            <input type="file" name="music_file" accept="audio/mpeg,audio/mp3,audio/wav,audio/x-wav,audio/mp4,audio/aac,audio/x-m4a"
                                   style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 320px; background: white;">
                            {% if automation_settings and automation_settings.music_file_path %}
                            <div style="color:#666; margin-top: 4px; font-size: 0.9em;">
                                –ü–æ—Ç–æ—á–Ω–∏–π —Ñ–∞–π–ª: <code>{{ automation_settings.music_file_path }}</code>
                            </div>
                            {% endif %}
                            <div style="color:#666; margin-top: 4px; font-size: 0.9em;">
                                –Ø–∫—â–æ –º—É–∑–∏–∫–∞ –∫–æ—Ä–æ—Ç—à–∞ ‚Äî –∑–∞—Ü–∏–∫–ª–∏—Ç—å—Å—è; —è–∫—â–æ –¥–æ–≤—à–∞ ‚Äî –æ–±—Ä—ñ–∂–µ—Ç—å—Å—è –ø—ñ–¥ –¥–æ–≤–∂–∏–Ω—É –≤—ñ–¥–µ–æ.
                            </div>
                        </div>
                    </div>

                    <div style="display:flex; gap:10px; flex-wrap:wrap;">
                        <div>
                            <label><strong>–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ RSS (—Ö–≤):</strong></label><br>
                            <input type="number" name="rss_check_interval_minutes" min="15" max="1440"
                                   value="{{ automation_settings.rss_check_interval_minutes if automation_settings else 240 }}"
                                   style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 120px;">
                        </div>

                        <div>
                            <label><strong>–ß–∞—Å –ø—É–±–ª—ñ–∫–∞—Ü—ñ–π (HH:MM, —á–µ—Ä–µ–∑ –∫–æ–º—É):</strong></label><br>
                            <input type="text" name="publish_times"
                                   value="{{ (automation_settings.publish_times | join(', ')) if automation_settings and automation_settings.publish_times else '09:00, 18:00' }}"
                                   style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 260px;">
                        </div>

                        <div>
                            <label><strong>–¢–∞–π–º–∑–æ–Ω–∞:</strong></label><br>
                            <input type="text" name="timezone"
                                   value="{{ automation_settings.timezone if automation_settings and automation_settings.timezone else 'Europe/Berlin' }}"
                                   style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 180px;">
                        </div>

                        <div>
                            <label><strong>–õ—ñ–º—ñ—Ç –ø–æ—Å—Ç—ñ–≤/–¥–µ–Ω—å:</strong></label><br>
                            <input type="number" name="max_posts_per_day" min="1" max="10"
                                   value="{{ automation_settings.max_posts_per_day if automation_settings else 2 }}"
                                   style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 120px;">
                        </div>
                    </div>

                    <div>
                        <button type="submit" style="padding: 10px 16px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; width: fit-content;">
                            üíæ –ó–±–µ—Ä–µ–≥—Ç–∏
                        </button>
                        <p style="color:#666; margin: 8px 0 0 0; font-size: 0.9em;">
                            –î–ª—è –ø–æ–≤–Ω–æ—ó –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó –ø–æ—Ç—Ä—ñ–±–µ–Ω –∑–∞–ø—É—â–µ–Ω–∏–π –≤–æ—Ä–∫–µ—Ä: <code>py -3.10 automation_runner.py</code>
                        </p>
                    </div>
                </form>
            </div>
            
            <form method="POST" action="{{ url_for('ai_fetch_trends') }}" style="margin-bottom: 20px;">
                <button type="submit" class="btn-primary"
                        style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer;">
                    üîÑ –û–Ω–æ–≤–∏—Ç–∏ —Ç—Ä–µ–Ω–¥–∏
                </button>
            </form>
            
            {% if trends %}
            <div class="trends-grid" style="display: grid; gap: 15px;">
                {% for trend in trends %}
                <div style="background: #f5f5f5; padding: 15px; border-radius: 8px; border-left: 4px solid #667eea;">
                    {% if trend.image_url %}
                    <div style="margin-bottom: 10px;">
                        <img src="{{ trend.image_url }}" alt="" style="width: 100%; max-height: 220px; object-fit: cover; border-radius: 8px;">
                    </div>
                    {% endif %}
                    <h4>{{ trend.title }}</h4>
                    <p style="color: #666; font-size: 0.9em;">{{ (trend.content or '')[:200] }}...</p>
                    <div style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;">
                        <span style="background: #e3f2fd; padding: 3px 8px; border-radius: 4px; font-size: 0.85em;">
                            üìç {{ trend.source }}
                        </span>
                        {% for kw in (trend.matched_keywords or [])[:3] %}
                        <span style="background: #e8f5e9; padding: 3px 8px; border-radius: 4px; font-size: 0.85em;">
                            {{ kw }}
                        </span>
                        {% endfor %}
                    </div>
                    <a href="{{ trend.link }}" target="_blank" style="display: inline-block; margin-top: 10px; color: #667eea;">
                        –ß–∏—Ç–∞—Ç–∏ –¥–∞–ª—ñ ‚Üí
                    </a>

                    <form method="POST" action="{{ url_for('ai_create_draft_from_trend', trend_id=trend.id) }}" style="margin-top: 12px;">
                        <button type="submit" style="padding: 10px 16px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">
                            ‚ú® –ó—Ä–æ–±–∏—Ç–∏ —Å–∞–º–º–∞—Ä—ñ + —á–µ—Ä–Ω–µ—Ç–∫—É –ø–æ—Å—Ç–∞
                        </button>
                    </form>
                </div>
                {% endfor %}
            </div>
            
            {% if content_ideas %}
            <h3 style="margin-top: 30px;">üí° –Ü–¥–µ—ó –¥–ª—è –ø–æ—Å—Ç—ñ–≤ –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ç—Ä–µ–Ω–¥—ñ–≤:</h3>
            {% for idea in content_ideas %}
            <div style="background: #fff3e0; padding: 15px; border-radius: 8px; margin-top: 10px;">
                <p>{{ idea.post_idea }}</p>
                <p style="color: #666; font-size: 0.9em; margin-top: 5px;">
                    üè∑Ô∏è {{ idea.hashtags[:5] | join(' ') }}
                </p>
            </div>
            {% endfor %}
            {% endif %}
            
            {% else %}
            <p style="color: #666; text-align: center; padding: 40px;">
                –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–û–Ω–æ–≤–∏—Ç–∏ —Ç—Ä–µ–Ω–¥–∏" —â–æ–± –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—ñ –Ω–æ–≤–∏–Ω–∏
            </p>
            {% endif %}
        </div>
    </div>
</div>

<script>
function showTab(tabName, btn) {
    // –°—Ö–æ–≤–∞—Ç–∏ –≤—Å—ñ —Ç–∞–±–∏
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.style.display = 'none';
    });
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.style.background = '#e0e0e0';
        btn.style.color = 'black';
    });
    
    // –ü–æ–∫–∞–∑–∞—Ç–∏ –æ–±—Ä–∞–Ω–∏–π
    document.getElementById('tab-' + tabName).style.display = 'block';

    const activeBtn = btn || document.querySelector('.tab-btn[data-tab="' + tabName + '"]');
    if (activeBtn) {
        activeBtn.style.background = '#667eea';
        activeBtn.style.color = 'white';
    }
}

function copyMessage(btn) {
    const text = btn.parentElement.querySelector('p').textContent;
    navigator.clipboard.writeText(text);
    btn.textContent = '‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!';
    setTimeout(() => btn.textContent = 'üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏', 2000);
}

function copyContent() {
    const caption = document.querySelector('#tab-content .card p[style*="pre-line"]').textContent;
    const hashtags = document.querySelector('#tab-content .card p[style*="color: #1976d2"]').textContent;
    navigator.clipboard.writeText(caption + '\n\n' + hashtags);
    alert('‚úÖ –ö–æ–Ω—Ç–µ–Ω—Ç —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!');
}

document.addEventListener('DOMContentLoaded', function() {
    const initialTab = '{{ active_tab or "analyze" }}';
    showTab(initialTab);
});
</script>
{% endblock %}
