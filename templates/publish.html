{% extends 'base.html' %}

{% block title %}–ü—É–±–ª–∏–∫–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞{% endblock %}

{% block content %}
<div class="publish-page">
    <div class="page-header">
        <h1>üì§ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤ Instagram</h1>
        <p>–ü—É–±–ª–∏–∫—É–π—Ç–µ –ø–æ—Å—Ç—ã, –∏—Å—Ç–æ—Ä–∏–∏ –∏ –∫–∞—Ä—É—Å–µ–ª–∏</p>
    </div>
    
    <div class="two-columns">
        <div class="publish-form-section">
            <div class="card">
                <h2>–°–æ–∑–¥–∞—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é</h2>
                
                <form method="POST" action="{{ url_for('publish_content') }}" enctype="multipart/form-data" class="publish-form">
                    <div class="form-group">
                        <label for="instagram_account_id">–ê–∫–∫–∞—É–Ω—Ç –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</label>
                        <select id="instagram_account_id" name="instagram_account_id" required>
                            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∞–∫–∫–∞—É–Ω—Ç --</option>
                            {% for account in accounts %}
                                <option value="{{ account.id }}">
                                    @{{ account.instagram_username }}
                                </option>
                            {% endfor %}
                        </select>
                        {% if not accounts %}
                            <div class="warning-box">
                                <p>‚ö†Ô∏è –î–æ–±–∞–≤—å—Ç–µ Instagram –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</p>
                                <a href="{{ url_for('manage_accounts') }}">–î–æ–±–∞–≤–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</a>
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label for="content_type">–¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞</label>
                        <select id="content_type" name="content_type" required onchange="updateMediaLabel()">
                            <option value="post">üì∑ –ü–æ—Å—Ç (–æ–¥–Ω–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è)</option>
                            <option value="carousel">üé† –ö–∞—Ä—É—Å–µ–ª—å (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ)</option>
                            <option value="story">üì± –ò—Å—Ç–æ—Ä–∏—è</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="media_files" id="media_label">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é</label>
                        <input type="file" id="media_files" name="media_files" required 
                            accept="image/*" class="file-input">
                        <small>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: JPG, PNG. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: 1080x1350 px</small>
                    </div>
                    
                    <div class="form-group" id="caption-group">
                        <label for="caption">–ü–æ–¥–ø–∏—Å—å –∫ –ø–æ—Å—Ç—É</label>
                        <textarea id="caption" name="caption" rows="5" 
                            placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞...&#10;&#10;–î–æ–±–∞–≤—å—Ç–µ —Ö—ç—à—Ç–µ–≥–∏: #example #instagram"></textarea>
                        <small>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 20-30 —Ö—ç—à—Ç–µ–≥–æ–≤</small>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-large btn-block" {% if not accounts %}disabled{% endif %}>
                        üì§ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å
                    </button>
                </form>
            </div>
        </div>
        
        <div class="tips-section">
            <div class="card tips-card">
                <h3>üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</h3>
                <ul class="tips-list">
                    <li>–ü—É–±–ª–∏–∫—É–π—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω–æ (3-4 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é)</li>
                    <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ 20-30 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ö—ç—à—Ç–µ–≥–æ–≤</li>
                    <li>–ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è engagement</li>
                    <li>–ü—É–±–ª–∏–∫—É–π—Ç–µ –≤ –ø–∏–∫–æ–≤—ã–µ —á–∞—Å—ã (18:00-21:00)</li>
                    <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Call-to-Action –≤ –∫–æ–Ω—Ü–µ</li>
                    <li>–†–∞–∑–º–µ—Ä —Ñ–æ—Ç–æ: 1080x1350 px (–ø–æ—Ä—Ç—Ä–µ—Ç)</li>
                    <li>–î–ª—è –∫–∞—Ä—É—Å–µ–ª–µ–π: –º–∞–∫—Å–∏–º—É–º 10 —Ñ–æ—Ç–æ</li>
                </ul>
            </div>
            
            {% if publications %}
                <div class="card">
                    <h3>üìú –ò—Å—Ç–æ—Ä–∏—è –ø—É–±–ª–∏–∫–∞—Ü–∏–π</h3>
                    <div class="publications-list">
                        {% for pub in publications %}
                            <div class="publication-item">
                                <div class="pub-icon">
                                    {% if pub.content_type == 'post' %}üì∑
                                    {% elif pub.content_type == 'carousel' %}üé†
                                    {% elif pub.content_type == 'story' %}üì±
                                    {% else %}üìÑ{% endif %}
                                </div>
                                <div class="pub-info">
                                    <span class="pub-type">{{ pub.content_type|title }}</span>
                                    <span class="pub-date">{{ pub.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
                                </div>
                                <span class="badge badge-{{ pub.status }}">
                                    {% if pub.status == 'published' %}‚úì
                                    {% elif pub.status == 'failed' %}‚úó
                                    {% else %}‚è≥{% endif %}
                                </span>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
function updateMediaLabel() {
    const contentType = document.getElementById('content_type').value;
    const label = document.getElementById('media_label');
    const input = document.getElementById('media_files');
    const captionGroup = document.getElementById('caption-group');
    
    if (contentType === 'carousel') {
        label.textContent = '–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ (2-10 —Ñ–∞–π–ª–æ–≤)';
        input.multiple = true;
    } else if (contentType === 'story') {
        label.textContent = '–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ –∏–ª–∏ –≤–∏–¥–µ–æ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏';
        input.multiple = false;
        captionGroup.style.display = 'none';
    } else {
        label.textContent = '–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é';
        input.multiple = false;
        captionGroup.style.display = 'block';
    }
}
</script>
{% endblock %}
